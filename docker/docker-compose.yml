services:
  redis-master:
    image: redis:8.2.0
    container_name: redis-master
    ports:
      - "6379:6379"
    command: ["redis-server", "/usr/local/etc/redis/redis.conf"]
    volumes:
      - ./redis/master/:/usr/local/etc/redis/  # ë””ë ‰í„°ë¦¬ ë§ˆìš´íŠ¸
    networks:
      - redis-network

  redis-slave1:
    image: redis:8.2.0
    container_name: redis-slave1
    ports:
      - "7001:6379"
    command: ["redis-server", "/usr/local/etc/redis/redis.conf", "--replicaof", "redis-master", "6379", "--masterauth", "1234"]
    volumes:
      - ./redis/slave/:/usr/local/etc/redis/  # ë””ë ‰í„°ë¦¬ ë§ˆìš´íŠ¸
    depends_on:
      - redis-master
    networks:
      - redis-network

  redis-slave2:
    image: redis:8.2.0
    container_name: redis-slave2
    ports:
      - "7002:6379"
    command: ["redis-server", "/usr/local/etc/redis/redis.conf", "--replicaof", "redis-master", "6379", "--masterauth", "1234"]
    volumes:
      - ./redis/slave/:/usr/local/etc/redis/  # ë””ë ‰í„°ë¦¬ ë§ˆìš´íŠ¸
    depends_on:
      - redis-master
    networks:
      - redis-network

  redis-slave3:
    image: redis:8.2.0
    container_name: redis-slave3
    ports:
      - "7003:6379"
    command: ["redis-server", "/usr/local/etc/redis/redis.conf", "--replicaof", "redis-master", "6379", "--masterauth", "1234"]
    volumes:
      - ./redis/slave/:/usr/local/etc/redis/  # ë””ë ‰í„°ë¦¬ ë§ˆìš´íŠ¸
    depends_on:
      - redis-master
    networks:
      - redis-network

  redis-sentinel1:
    image: redis:8.2.0
    container_name: redis-sentinel1
    command: ["redis-sentinel", "/usr/local/etc/redis/redis.conf"]
    ports:
      - "26379:26379"
    volumes:
      - ./redis/sentinel/:/usr/local/etc/redis/  # ðŸ”¥ í•µì‹¬ ë³€ê²½
    depends_on:
      - redis-master
      - redis-slave1
      - redis-slave2
      - redis-slave3
    networks:
      - redis-network

  redis-sentinel2:
    image: redis:8.2.0
    container_name: redis-sentinel2
    command: ["redis-sentinel", "/usr/local/etc/redis/redis.conf"]
    ports:
      - "26380:26379"
    volumes:
      - ./redis/sentinel/:/usr/local/etc/redis/  # ðŸ”¥ í•µì‹¬ ë³€ê²½
    depends_on:
      - redis-master
      - redis-slave1
      - redis-slave2
      - redis-slave3
    networks:
      - redis-network

  redis-sentinel3:
    image: redis:8.2.0
    container_name: redis-sentinel3
    command: ["redis-sentinel", "/usr/local/etc/redis/redis.conf"]
    ports:
      - "26381:26379"
    volumes:
      - ./redis/sentinel/:/usr/local/etc/redis/  # ðŸ”¥ í•µì‹¬ ë³€ê²½
    depends_on:
      - redis-master
      - redis-slave1
      - redis-slave2
      - redis-slave3
    networks:
      - redis-network

  spring-app:
    build: .
    container_name: spring-app
    ports:
      - "8080:8080"
    environment:
      - SPRING_PROFILES_ACTIVE=local
      - KAKAO_CLIENT_ID=${KAKAO_CLIENT_ID}  # í™˜ê²½ë³€ìˆ˜ë¡œ ë³€ê²½
    depends_on:
      - redis-sentinel1
      - redis-sentinel2
      - redis-sentinel3
    networks:
      - redis-network

networks:
  redis-network:
    name: redis-network
    driver: bridge
